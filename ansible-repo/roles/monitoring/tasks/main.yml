---
# Monitoring configuration role

- name: Monitoring Role - Create monitoring directory
  file:
    path: /opt/monitoring
    state: directory
    mode: '0755'

- name: Create monitoring script
  copy:
    content: |
      #!/bin/bash
      # System Monitoring Script
      # Generated by Ansible-Pull
      
      echo "=== System Monitoring Report ===" 
      echo "Timestamp: $(date '+%Y-%m-%d %H:%M:%S')"
      echo ""
      
      echo "Hostname: $(hostname)"
      echo "Uptime: $(uptime -p 2>/dev/null || uptime)"
      echo ""
      
      echo "CPU Usage:"
      top -bn1 | grep "Cpu(s)" || echo "Not available in this environment"
      echo ""
      
      echo "Memory Usage:"
      free -h || echo "Not available in this environment"
      echo ""
      
      echo "Disk Usage:"
      df -h / || echo "Not available in this environment"
      echo ""
      
      echo "System Load:"
      cat /proc/loadavg 2>/dev/null || echo "Not available in this environment"
    dest: /opt/monitoring/check_system.sh
    mode: '0755'

- name: Create monitoring log file
  copy:
    content: |
      # Monitoring Log File
      # Managed by Ansible-Pull
      
      [{{ ansible_date_time.iso8601 }}] System monitoring initialized
      [{{ ansible_date_time.iso8601 }}] Hostname: {{ ansible_hostname }}
      [{{ ansible_date_time.iso8601 }}] OS: {{ ansible_distribution }} {{ ansible_distribution_version }}
      [{{ ansible_date_time.iso8601 }}] Python version: {{ ansible_python_version }}
    dest: /opt/monitoring/system.log
    mode: '0644'

- name: Create monitoring status file
  copy:
    content: |
      DEPLOYMENT_STATUS=SUCCESS
      DEPLOYMENT_TIME={{ ansible_date_time.iso8601 }}
      HOSTNAME={{ ansible_hostname }}
      OS={{ ansible_distribution }}
      ENVIRONMENT=production
    dest: /opt/monitoring/status.conf
    mode: '0644'

- name: Display monitoring role completion
  debug:
    msg: âœ“ Monitoring role configuration completed
